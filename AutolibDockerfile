FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    python3-pip \
    python3-dev \
    tzdata \
    gcc \
    g++ \
    libssl-dev \
    libffi-dev \
    build-essential \
    openssh-server \
    sudo \
    telnet && \
    ln -fs /usr/share/zoneinfo/America/Vancouver /etc/localtime && \
    dpkg-reconfigure -f noninteractive tzdata && \
    rm -rf /var/lib/apt/lists/*

# Create user with password and sudo access
RUN useradd -m -s /bin/bash fosqa && \
    echo 'fosqa:ftnt123!' | chpasswd && \
    usermod -aG sudo fosqa

# Setup SSH
RUN mkdir /var/run/sshd && \
    echo 'PermitRootLogin yes' >> /etc/ssh/sshd_config && \
    echo 'PasswordAuthentication yes' >> /etc/ssh/sshd_config && \
    echo 'UsePAM yes' >> /etc/ssh/sshd_config

# Ensure ssh keys are generated
RUN ssh-keygen -A

# Expose SSH port
EXPOSE 22

# Optional Python stuff
WORKDIR /app
COPY requirements.txt /app/requirements.txt
RUN pip3 install --no-cache-dir -r requirements.txt || echo "No requirements.txt found"

# Default command
CMD ["/usr/sbin/sshd", "-D"]

# docker build -t autolib_u2204 -f AutolibDockerfile .
# docker run -d --name autolib_debug -p 2222:22 -p 8888:8080 -v /home/fosqa/autolib_rain:/app autolib_u2204

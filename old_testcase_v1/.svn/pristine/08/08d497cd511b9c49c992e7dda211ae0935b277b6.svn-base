# Test Case ID: 811530
# Objective: Verify the firewall can create a TCP based custom service when create policy
#
####################################################################################
[FVM_A]
	comment 811530:Busy:Verify the firewall can create a TCP based custom service when create policy
	
	config firewall service custom
    		edit "811530"
       		 set protocol TCP/UDP
        	set tcp-portrange 80-80:1-65535
   		 next
	end

config system interface
        edit "FVM_A:PORT2"
            set vdom "root"
            set ip FVM_A:IPV4_PORT2 255.255.255.0
            set allowaccess ping https ssh http telnet
        next
        edit "FVM_A:PORT3"
            set vdom "root"
            set mode static
            set ip FVM_A:IPV4_PORT3 255.255.255.0
            set allowaccess ping https ssh http telnet
        next
end

	
config firewall policy
    edit 811530
        set name "811530"
        set srcintf "FVM_A:PORT2"
        set dstintf "FVM_A:PORT3"
        set srcaddr "all"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
        set nat enable
	select service 811530
	set logtraffic all
    next
end
    
    sleep 10
    show firewall policy

    diag sys session clear
  
	
[PC_01]
    route -n
    route del -net 172.16.200.0 netmask 255.255.255.0
    route del -host 172.16.200.55

    route add -host 172.16.200.55 gw FVM_A:IPV4_PORT2
    route -n
    sleep 10

    ping -c 3 FVM_A:PC_05
    expect -e "64 bytes from" -for 811530 -fail match -t 5
    wget --delete-after http://FVM_A:PC_05
    expect -e "100%"  -for 811530 -t 10 
 
	
[FVM_A]
	
	config firewall policy
           purge
	   y
	end

	config firewall service custom
    		del "811530"
	end
	
	report 811530


	 	 

# 866426ï¼šVerify VM license removed after exe factoryreset   
# fortiguard settting default 
# 
##############################################################

[FVM_A]
    
    comments: 866426 Verify factoryreset remove vm license
    # get license file name
    setlicense -t 02G -for SN -to lic    
    
    execute restore vmlicense tftp FVM_A:LICENSE_DIR{$lic} FVM_A:LICENSE_SERVER
	
    get system status | grep 'Serial-Number' -A 5
    expect -e "FGVM02T" -for 866426 -t 5
    expect -e "License Status: Valid" -for 866426 -t 5
    expect -e "2 CPU/2 allowed" -for 866426 -t 5
 
    config system global
        set admintimeout 479
    end

    execute factoryreset

    get system status | grep 'Serial-Number' -A 5
    expect -e "License Status: Invalid" -for 866426 -t 5

    show full system global | grep admintimeout
    expect -e "admintimeout 5" -for 866426 -t 5

    report 866426

    config system interface
        edit FVM_A:PORT1
            set mode static
            set ip FVM_A:IPV4_PORT1 255.255.255.0
            set allowaccess ping https ssh http telnet
        next
    end

    config router static
        edit 1
            set gateway 10.6.30.254
            set device FVM_A:PORT1
        next
    end

    sleep 5   
    execute restore vmlicense tftp FVM_A:LICENSE_DIR{$lic} FVM_A:LICENSE_SERVER
    get system status | grep 'Serial-Number' -A 5
    expect -e "FGVM02T" -for 866426 -t 5
    expect -e "License Status: Valid" -for 866426 -t 5

    

# 937842ï¼šVerify FGTVM with two disks,1st for log and 2nd for wanopt 
#  
################################################################
[PC_KVM]
    # reduce test VM memory size to 2G
    virsh shutdown FVM_A
    sleep 10

    virsh setmaxmem FVM_A 2G --config
    virsh setmem FVM_A 2G --config

    virsh dominfo FVM_A | grep memory
    expect -e  "KiB" -for 937842 -t 5

    virsh dominfo FVM_A | grep "CPU(s)"
    expect -e "4" -for 1030876 -t 5

    virsh start FVM_A
    #virsh --connect qemu:///system start FVM_A
    sleep 30 
    

[FVM_A]
    ### 937842.txt ###
    comment: Verify download permanent trial license from forticare

    forcelogin
    #remove license
    execute factoryreset2    
    
    # config forticare account
    exe vm-license-options account-id fosvmqa@gmail.com
    exe vm-license-options account-password Fosvmqa123!

    exe vm-license-options show
    expect -e "Account ID: fosvmqa@gmail.com" -for 937842 -t 5
    expect -e "Government: no" -for 937842 -t 5

    exe vm-license
    y
    sleep 10
    expect -e "VM license install succeeded" -for 937842 -t 10 
    sleep 30
    forcelogin
    sleep 5	
    get system status | grep 'Serial-Number' -A 10 
    expect -e "FGVMEV" -for 937842 -t 5
    expect -e "License Status: Valid" -for 937842 -t 5
    expect -e "1 CPU/1 allowed" -for 1030876 -t 5

    report 937842

#[PC_KVM]
    # restore test VM memory size to 6G
    virsh shutdown FVM_A
    sleep 10

    virsh setmaxmem FVM_A 6G --config
    virsh setmem FVM_A 6G --config

    virsh start FVM_A
    sleep 30


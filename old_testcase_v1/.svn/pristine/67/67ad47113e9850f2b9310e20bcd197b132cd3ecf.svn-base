# 911059ï¼šVerify s04-license can be valided
# fortiguard settting default (anycast=enable)
# 
########################################################

[FVM_A]
     comment: Verify S04 can be valided base on cpu cores with default FGD setting
    setlicense -t 04S -for SN -to lic

    #remove license
    execute factoryreset2    
    
    get system status | grep 'Serial-Number' -A 5
    expect -e "License Status: Invalid" -for 911059 -t 5
    
    execute restore vmlicense tftp FVM_A:LICENSE_DIR{$lic} FVM_A:LICENSE_SERVER
    sleep 60
	
    get system status | grep 'Serial-Number' -A 5
    expect -e "FGVMSL" -for 911059 -t 5
    expect -e "License Status: Valid" -for 911059 -t 5
    expect -e "1 CPU/4 allowed" -for 911059 -t 5

    #s-license need a reboot or exe cpu add to activate
    #kernel panic 
    #exe cpu add 3
    #expect -e "Active CPU number: 4" -for 911059 -t 10

    diag debug vm-print-license
    expect -e "Model: 18" -for 911059 -t 5
    expect -e "CPU: 4" -for 911059 -t 5

    # test 996641: subscription vdom 25 applied 
    get system status | grep "domains"
    expect -e "Max number of virtual domains: 27" -for 996641 -t 5

    diagnose debug vm-print-license
    expect -e "permanent: 2" -for 996641 -t 5
    expect -e "subscription: 25" -for 996641 -t 5

    comment: check 815 enterprise bundle contracts
    diagnose test update info | grep "System contracts" -A 40
    expect -e "ENHN" -for 1021269 -t 5
    expect -e "FMWR" -for 1021269 -t 5
    expect -e "SPAM" -for 1021269 -t 5
    expect -e "VMLS" -for 1021269 -t 5
    expect -e "IOTH" -for 1021269 -t 5
    expect -e "ISDB" -for 1021269 -t 5
    expect -e "SFAS" -for 1021269 -t 5

    report 911059
    report 996641
    report 1021269



   

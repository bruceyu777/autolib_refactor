# 973364ï¼šVerify vm license status change event log 
# 
###################################################

[FVM_A]
    ### 973364.txt ###
    comments: Verify event log generated when vm license status change 

    # get license file name
    setlicense -t 04G -for SN -to lic

    exe log delete-all
    
    #remove license
    execute factoryreset2    
    
    get system status | grep 'Serial-Number' -A 3
    expect -e "License Status: Invalid" -for 973364 -t 5

    exe log filter device disk
    exe log filter category event
    exe log filter field logid 0100022804
    exe log display
    expect -e "sn=\"FGVM.*\" status=\"INVALID\"" -for 973364 -t 10

    
    execute restore vmlicense tftp FVM_A:LICENSE_DIR{$lic} FVM_A:LICENSE_SERVER
	
    get system status | grep 'Serial-Number' -A 3
    expect -e "FGVM04T" -for 973364 -t 5
    expect -e "License Status: Valid" -for 973364 -t 5
    expect -e "4 CPU/4 allowed" -for 973364 -t 5

    exe log filter device disk
    exe log filter category event
    exe log filter field logid 0100022804
    exe log display
    expect -e "sn=\"FGVM04T.*\" status=\"VALID\" msg=\"License status changed to VALID\"" -for 973364 -t 10


    report 973364
   

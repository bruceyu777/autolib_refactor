# 1014988ï¼šVerify ipv4 traffic block base on deny policy 
# 
# 
##################################################################

[FFW_A]
    ### 1014988.txt ###
    comment: 1014988:Verify ipv4 firewall policy work
    #setlicense -t FFW -for SN -to lic

    get system status | grep 'Serial-Number' -A 3
    expect -e "License Status: Valid" -for 1014988 -t 5

    config system interface
        edit "FFW_A:PORT2"
            set mode static
            set ip FFW_A:IPV4_PORT2/24
        next
        edit "FFW_A:PORT3"
            set mode static
            set ip FFW_A:IPV4_PORT3/24
        next
    end

    config firewall policy
        purge
        y
        edit 1014988
            set name "1014988"
            set srcintf "FFW_A:PORT2"
            set dstintf "FFW_A:PORT3"
            set srcaddr "all"
            set dstaddr "all"
            set action deny
            set schedule "always"
            set service ALL
            set logtraffic all
            set nat enable
        next
    end

    config log memory setting
        set status enable
    end

    sleep 10
    diag sys session clear
    exe log delete-all
    y


[PC_02]
    route delete PC_05:IPV4_ETH1
    sleep 3
    route add PC_05:IPV4_ETH1 gw FFW_A:IPV4_PORT2
    route -n 
    sleep 3

    ping -c 5 PC_02:DESTINATION4 
    expect -e "64 bytes from" -fail match -for 1014988 -t 5

    route delete PC_05:IPV4_ETH1 gw FFW_A:IPV4_PORT2


[FFW_A]
    diagnose sys session clear

    exe log filter device memory 
    exe log filter category traffic
    exe log filter field subtype forward
    exe log filter field action deny
    exe log display
    expect -e "policyid=1014988" -for 1014988 -t 5

    config firewall policy
     purge
       y
    end

    report 1014988
   

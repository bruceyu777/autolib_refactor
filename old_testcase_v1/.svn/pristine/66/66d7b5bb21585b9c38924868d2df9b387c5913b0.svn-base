# 888212ï¼šVerify Fortinet_Factory and Fortinet_Factory_Backup CN are changed to FGT VM serial number 
# 
# 
#######################################################

[PC_KVM]
    rm /tftpboot/Fortinet_Factory.cer

[FVM_A]
    comment: Verify Fortinet_Factory and Fortinet_Factory_Backup CN  

    # get license file name
    setlicense -t 04G -for SN -to lic
 
    execute restore vmlicense tftp FVM_A:LICENSE_DIR{$lic} FVM_A:LICENSE_SERVER
	
    get system status | grep 'Serial-Number' -A 5
    expect -e "(FGVM.*)" -for 888212 -t 5

    execute vpn certificate local export tftp Fortinet_Factory cer Fortinet_Factory.cer FVM_A:LICENSE_SERVER
    expect -e "Done" -for 888212 -t 5

[PC_KVM]
    
    openssl x509 -in /tftpboot/Fortinet_Factory.cer -text | grep  Subject:
    setvar -e "CN = (FGVM.*), " -to sn

[FVM_A]

    get system status | grep 'Serial-Number' -A 5
    varexpect -v {$sn} -for 888212 -t 5
    
    report 888212
   

# 1014981ï¼šVerify FFVMBB license validate by FMG 
# FFW_VM in a closed network
###############################################################


[FFW_A]
    ### 1014981.txt ###
    comments: Verify FFVMBB can be valided by FGD 

    setlicense -t FFW -for SN -to lic
    
    #remove license
    execute factoryreset2    
    
    # add fgfm to allowaccess
    config system interface
        edit FFW_A:PORT1
            set allowaccess ping https ssh snmp http telnet fgfm
        next
    end

    #config static route only to FMG
    config router static
        edit 1
            set dst 172.18.64.0 255.255.255.0
            set gateway 10.6.30.254
            set device FFW_A:PORT1
        next
    end

    #config central management and update and rating using FMG
    config system central-management
        unset type 
        config server-list
            edit 1
                set server-type update rating
                set server-address FFW_A:FMG_IP
            next
        end
        set include-default-servers disable
    end

    execute restore vmlicense tftp FFW_A:LICENSE_DIR{$lic} FFW_A:LICENSE_SERVER
    sleep 30
	
    get system status | grep 'Serial-Number' -A 5
    expect -e "FFVMBB" -for 1014981 -t 5
    expect -e "License Status: Valid" -for 1014981 -t 5

    report 1014981

[FFW_A]

    config router static
        edit 1
            unset dst 
            set gateway 10.6.30.254
            set device FFW_A:PORT1
        next
    end

    config system central-management
        config server-list
            delete 1
        end
        set include-default-servers enable
        set mode normal
    end

    # validate license with internal FGD
    config system dns
        set primary 172.17.254.148
        set secondary 172.17.254.151
    end

    config system fortiguard
        set fortiguard-anycast disable
        set update-server-location any
    end






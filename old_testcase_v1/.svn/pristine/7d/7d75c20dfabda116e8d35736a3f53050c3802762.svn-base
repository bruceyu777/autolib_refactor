
############## 811531 ##################
[FVM_A]
	comment 811531:Busy:Verify the firewall can create a UDP based custom service when config policy
	
	config firewall service custom
    		edit "811531"
       		 set protocol TCP/UDP
        	 set udp-portrange 69-69:1-65535
   		 next
	end

config system interface
        edit "port2"
            set vdom "root"
            set ip 10.1.100.200 255.255.255.0
            set allowaccess ping https ssh http telnet
        next
        edit "port3"
            set vdom "root"
            set mode static
            set ip 172.16.200.200 255.255.255.0
            set allowaccess ping https ssh http telnet
        next
end

	
config firewall policy
    edit 811531
        set name "811531"
        set srcintf "FVM_A:PORT2"
        set dstintf "FVM_A:PORT3"
        set srcaddr "all"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set nat enable
    	set service 811531
	    set logtraffic all
    next
end
  diag sys session clear
  
show firewall policy

	
[PC_01]
    route -n
    route del -net 172.16.200.0 netmask 255.255.255.0
    route del -host 172.16.200.55

    route add -host 172.16.200.55 gw FVM_A:IPV4_PORT2
    sleep 10

    ping -c 3 FVM_A:PC_05
    expect -e "64 bytes from" -for 811531 -fail match -t 5
    sleep 1	

    rm -f tftpfile
#    tftp FVM_A:FVM_A -c get tftpfile
    tftp FVM_A:PC_05 <<EOF
    get tftpfile
    quit
    EOF

    ls -l
    expect -e "tftpfile" -for 811531 -t 5
    rm -f tftpfile
	
	
[FVM_A]
	

    config firewall policy
     purge
           y
        end

	config firewall service custom
    		del "811531"
	end
	
	 
 	report 811531

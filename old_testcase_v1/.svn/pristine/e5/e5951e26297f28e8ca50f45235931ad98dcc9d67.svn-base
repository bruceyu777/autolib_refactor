# Test Case ID: 811529
# Objective: Verify the firewall can recognize and process the predefined services when config in policy
#
#########################################################################
[FVM_A]
    comment 811529:Busy:Verify the firewall can recognize and process the predefined services 

config system interface
        edit "FVM_A:PORT2"
            set vdom "root"
            set ip FVM_A:IPV4_PORT2 255.255.255.0
            set allowaccess ping https ssh http telnet
        next
        edit "FVM_A:PORT3"
            set vdom "root"
            set mode static
            set ip FVM_A:IPV4_PORT3 255.255.255.0
            set allowaccess ping https ssh http telnet
        next
end

config firewall policy
    purge
    y
    edit 811529
        set name "811529"
        set srcintf "FVM_A:PORT2"
        set dstintf "FVM_A:PORT3"
        set srcaddr "all"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
        set nat enable
	select service HTTP
	set logtraffic all
    next
end

    sleep 10	
    diag sys session clear
    show firewall policy
	
[PC_01]
    route -n
    route del -net 172.16.200.0 netmask 255.255.255.0
    route del -host 172.16.200.55

    route add -host 172.16.200.55 gw FVM_A:IPV4_PORT2
    route -n
    sleep 5	
	
    ping -c 3 FVM_A:PC_05
    expect -e "64 bytes from" -for 811529 -fail match -t 5

    wget --delete-after http://PC_01:DESTINATION4
    expect -e "200 OK"  -for 811529 -t 20 


[FVM_A]

    # ensure PING is exist
    config firewall service custom
        edit "PING"
            set category "Network Services"
            set protocol ICMP
            set icmptype 8
            unset icmpcode
        next
    end
	
    config firewall policy
                edit 811529
                        set nat enable
                        select service PING
                next
        end

    sleep 5
    diag sys session clear
		
[PC_01]
    ping -c 3 FVM_A:PC_05
    expect -e "64 bytes from" -for 811529 -t 10

    wget --timeout=10 --delete-after http://PC_01:DESTINATION4
    expect -e "100%" -fail match -for 811529 -t 10 
	
	
[FVM_A]

    config firewall policy
         purge
	 y
    end
 
    report 811529

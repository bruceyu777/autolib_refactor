# Test Case ID: 1050907
# Objective: Verify full IPS extended DB can be retrieved via manual update 
# vcpu >= 8
# full IPS extended DB: NIDS027
########################################################
[FVM_A]
    comment 1050907:Busy:Verify slim NIDS027 db on vcpu <= 4

    exe cpu show
    expect -e "Active CPU number: [1-4]" -for 1050907 -t 5

    show full ips global | grep database
    expect -e "database extended" -for 1050907 -t 5

    config firewall policy
	edit 1050907
		set name "1050907"
		set srcintf "FVM_A:PORT2"
		set dstintf "FVM_A:PORT3"
		set srcaddr "all"
		set dstaddr "all"
		set action accept
		set schedule "always"
		set service "ALL"
		set action accept
		set utm-status enable
        	set ssl-ssh-profile "certificate-inspection"
        	set ips-sensor "default"
                set logtraffic all
	next
    end
  
    diagnose autoupdate downgrade enable

    exe restore ips tftp packages/nids-740-22.490.pkg 10.6.30.139 
    sleep 10

    diagnose test update info | grep NIDS
    expect -e "NIDS027 installed successfully" -for 1050907 -t 5
    expect -e "NIDS02705-00022.00490" -for 1050907 -t 5

    
    exe restore ips tftp packages/nids-740-22.498.pkg 10.6.30.139

    sleep 10
 
    diagnose test update info | grep NIDS
    expect -e "NIDS027 installed successfully" -for 1050907 -t 5
    expect -e "NIDS02705-00022.00498" -for 1050907 -t 5

    report 1050907

 
    config firewall policy
     purge
     y
    end
	

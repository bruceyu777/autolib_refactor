# 808043ï¼šVerify exe factoryreset keepvmlicense
# fortiguard setting default
#
#############################

[FVM_A]

    comments: 808043 Verify factoryreset keepvmlicense
    # get license file name
    setlicense -t 02G -for SN -to lic

    execute restore vmlicense tftp FVM_A:LICENSE_DIR{$lic} FVM_A:LICENSE_SERVER

    sleep 200
    get system status | grep 'Serial-Number' -A 5
    setvar -e "Serial-Number: (FGVM.*)" -to sn
    expect -e "License Status: Valid" -for 808043 -t 5
    expect -e "2 CPU/2 allowed" -for 808043 -t 5

    config system global
        set admintimeout 479
    end

    show router static
    expect -e "gateway 10.6.30.254" -for 808043 -t 5

    execute factoryreset keepvmlicense


    show full system global | grep admintimeout
    expect -e "admintimeout 5" -for 808043 -t 5

    show router static
    expect -e "gateway 10.6.30.254" -fail match -for 808043 -t 5

    config system interface
        edit FVM_A:PORT1
            set mode static
            set ip  FVM_A:IPV4_PORT1 255.255.255.0
            set allowaccess ping https ssh http telnet
        next
    end

    config router static
        edit 1
            set gateway 10.6.30.254
            set device FVM_A:PORT1
        next
    end

    diag test update setup

    sleep 100

[FVM_A]
    admin
    admin
    get system status | grep 'Serial-Number' -A 5
    expect -e "FGVM02T" -for 808043 -t 5
    expect -e "License Status: Valid" -for 808043 -t 5


    report 808043




# Test Case ID: 1049632
# Objective: Verify slim IPS extended DB retrieved via FDS 
# vcpu <= 4
# slim IPS extended DB: NIDS026
########################################################
[FVM_A]
    comment 1049632:Busy:Verify slim NIDS026 db on vcpu <= 4

    exe cpu show
    expect -e "Active CPU number: [1-4]" -for 1049632 -t 5

    show full ips global | grep database
    expect -e "database extended" -for 1049632 -t 5

     config system interface
        edit "port2"
            set vdom "root"
            set ip 10.1.100.200 255.255.255.0
            set allowaccess ping https ssh http telnet
        next
        edit "port3"
            set vdom "root"
            set mode static
            set ip 172.16.200.200 255.255.255.0
            set allowaccess ping https ssh http telnet
        next
    end

    config firewall policy
	edit 1049632
		set name "1049632"
		set srcintf "FVM_A:PORT2"
		set dstintf "FVM_A:PORT3"
		set srcaddr "all"
		set dstaddr "all"
		set action accept
		set schedule "always"
		set service "ALL"
		set action accept
		set utm-status enable
        	set ssl-ssh-profile "certificate-inspection"
        	set ips-sensor "default"
                set logtraffic all
	next
    end
  
    diagnose autoupdate downgrade enable

    exe restore ips tftp packages/nids-740-22.490.pkg 10.6.30.139 
    sleep 10

    diagnose test update info | grep NIDS
    expect -e "Update successful on NIDS26" -for 1049632 -t 5
    expect -e "NIDS02605-00022.00490" -for 1049632 -t 5

    fnsysctl killall updated 
    exe update-ips 

    sleep 60
 
    diagnose test update info | grep NIDS
    expect -e "Update successful on NIDS26" -for 1049632 -t 5
    expect -e "NIDS02605-00022.00490" -fail match -for 1049632 -t 5

    report 1049632

 
    config firewall policy
     purge
     y
    end
	

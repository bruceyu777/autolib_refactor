# 911061ï¼šVerify s04-license support stackable vdom license 
# fortiguard settting default (anycast=enable)
# 
###########################################3333

[PC_KVM]
    ### 911061.txt ###
    comment: Verify stackable vdom lic apply on s04 vm

    # get license file name
    #cat PC_KVM:LICENSE_DIR/PC_KVM:LIECENSE_FILE | grep 04S
    #setvar -e "(?n)^04S,(FGVMSL.*?lic)," -to lic
    setlicense -t 04S -for SN -to lic

[FVM_A]
    #remove license
    execute factoryreset2    
    
    get system status | grep 'Serial-Number' -A 3
    expect -e "License Status: Invalid" -for 911061 -t 5
    
    execute restore vmlicense tftp FVM_A:LICENSE_DIR{$lic} FVM_A:LICENSE_SERVER
    sleep 60
	
    diag debug vm-print-license
    expect -e "Model: SL" -for 911061 -t 5
    expect -e "permanent: 1" -for 911061 -t 5

    # apply vdom license
    setlicense -t 04S -for VDOM -to vdlic

    # import vdom license
    execute upd-vd-license {$vdlic}
    y
    sleep 10

    get system status | grep 'domain'
    expect -e "Max number of virtual domains: 5" -for 760927 -t 10

    diag debug vm-print-license
    expect -e "permanent: 5" -for 760927 -t 5

    report 911061
   

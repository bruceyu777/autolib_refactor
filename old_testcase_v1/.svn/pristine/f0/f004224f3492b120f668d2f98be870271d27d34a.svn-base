# 943007ï¼šVerify ipv6 traffic pass/block base on  policy 
# 
# 
##################################################################

[FVM_A]
    ### 943007.txt ###
    comment: 943007:Verify ipv6 firewall policy work
    setlicense -t 04G -for SN -to lic

    get system status | grep 'Serial-Number' -A 3
    expect -e "License Status: Valid" -for 943007 -t 5

    config system interface
        edit "FVM_A:PORT2"
            config ipv6
                set ip6-mode static
                set ip6-address FVM_A:IPV6_PORT2/64
            end
        next
        edit "FVM_A:PORT3"
            config ipv6
                set ip6-mode static
                set ip6-address FVM_A:IPV6_PORT3/64
            end
        next
    end

    config firewall policy
        purge
        y
        edit 943007
            set name "943007"
            set srcintf "FVM_A:PORT2"
            set dstintf "FVM_A:PORT3"
            set srcaddr6 "all"
            set dstaddr6 "all"
            set action deny
            set schedule "always"
            set service ALL
            set logtraffic all
        next
    end

    config log memory setting
        set status enable
    end

    sleep 10
    diag sys session6 clear
    exe log delete-all
    y

[PC_05]
    ip -6 addr add 2000:172:16:200::55/64 dev PC_05:ETH1 
    sleep 3

[PC_02]
    ip -6 addr add PC_02:IPV6_ETH1/64 dev PC_02:ETH1 
    route -A inet6 add PC_05:IPV6_ETH1 gw FVM_A:IPV6_PORT2
    route -n -6
    sleep 3

    ping6 -c 5 PC_05:IPV6_ETH1
    expect -e "64 bytes from" -fail match -for 943007 -t 5


[FVM_A]
    diagnose sys session6 clear

    exe log filter device memory 
    exe log filter category traffic
    exe log filter field subtype forward
    exe log filter field action deny
    exe log display
    expect -e "policyid=943007" -for 943007 -t 5

    config firewall policy
        edit 943007
            set action accept
            set nat enable
            set logtraffic all
        next
    end

    show firewall policy 943007

    sleep 10

    diag sys session6 clear
    sleep 3

[PC_02]
    route -6 -n
    ping6 -c 5 PC_05:IPV6_ETH1
    #expect -e "64 bytes from" -for 943007 -t 20

    route -A inet6 del PC_05:IPV6_ETH1 gw FVM_A:IPV6_PORT2

[FVM_A]
    diag sys session6 clear
    sleep 2
    exe log filter device memory 
    exe log filter category traffic
    exe log filter field subtype forward
    exe log filter field action accept
    exe log filter field proto 58
    exe log display
    expect -e "policyid=943007" -for 943007 -t 5


    config firewall policy
      delete 943007 
    end

    report 943007
   

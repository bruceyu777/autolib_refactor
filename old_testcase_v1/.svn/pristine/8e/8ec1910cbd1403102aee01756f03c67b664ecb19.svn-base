# 911064ï¼šVerify new v-license can be activate on vm with v-license 
# fortiguard settting default (anycast=enable)
# 
#############################

[PC_KVM]
    ### 911064.txt ###
    comments: Verify new v-license loading on vm with v-license

    # get license file name
    #cat PC_KVM:LICENSE_DIR/PC_KVM:LIECENSE_FILE | grep 04S
    #setvar -e "(?n)^04S,(FGVMSL.*?lic)," -to lic1
    #cat PC_KVM:LICENSE_DIR/PC_KVM:LIECENSE_FILE | grep 02S
    #setvar -e "(?n)^02S,(FGVMSL.*?lic)," -to lic2 

    setlicense -t 04V -for SN -to lic1
    setlicense -t 02V -for SN -to lic2

[FVM_A]
    
    # fortiguard default setting
    config system fortiguard
        unset fortiguard-anycast
    end
    
    execute restore vmlicense tftp FVM_A:LICENSE_DIR{$lic1} FVM_A:LICENSE_SERVER
	
    get system status | grep 'Serial-Number' -A 5
    expect -e "FGVM4V" -for 911064 -t 5
    expect -e "License Status: Valid" -for 911064 -t 5
    expect -e "4 CPU/4 allowed" -for 911064 -t 5

    diag debug vm-print-license
    expect -e "Model: 8" -for 911064 -t 5
    expect -e "CPU: 4" -for 911064 -t 5

    execute restore vmlicense tftp FVM_A:LICENSE_DIR{$lic2} FVM_A:LICENSE_SERVER

    get system status | grep 'Serial-Number' -A 5
    expect -e "FGVM2V" -for 911064 -t 5
    expect -e "License Status: Valid" -for 911064 -t 5
    expect -e "2 CPU/2 allowed" -for 911064 -t 5

    diag debug vm-print-license
    expect -e "Model: 6" -for 911064 -t 5
    expect -e "CPU: 2" -for 911064 -t 5

    report 911064
   

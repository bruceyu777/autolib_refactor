# Test Case ID: 811539
# Objective: Verify Interface administrative access
#
#################################################################

[FVM_A]
	comment 811539:Busy:Verify Interface administrative access http, https, telnet, ssh, ping, snmp works when set allowaccess

	
    config system interface
        edit "FVM_A:PORT2"
            set vdom "root"
            set ip FVM_A:IPV4_PORT2 255.255.255.0
            set allowaccess ping https ssh snmp http telnet 
        next
   end

    config sys global
        set admin-https-redirect disable
	set admin-https-ssl-versions tlsv1-0 tlsv1-1 tlsv1-2
    end

    config system snmp sysinfo
        set status enable
        set description "fortivm64"
        set contact-info "lab"
        set location "lab"
    end

    config system snmp community
        edit 1
            set name "REGR-SYS"
            config hosts
               edit 1
                   set ip 10.1.100.11 255.255.255.255
               next
           end
           set events cpu-high mem-low log-full intf-ip vpn-tun-up vpn-tun-down ha-switch ha-hb-failure ips-signature ips-anomaly av-virus av-oversize av-pattern av-fragmented fm-if-change bgp-established bgp-backward-transition ha-member-up ha-member-down ent-conf-change av-conserve av-bypass av-oversize-passed av-oversize-blocked ips-pkg-update ips-fail-open faz-disconnect wc-ap-up wc-ap-down
        next
    end

	
[PC_01] 
 
    #########PING###############
    ping -c 5 FVM_A:IPV4_PORT2
    expect -e "64 bytes from" -t 10 -for 811539
    sleep 10

    ########TELNET##############
    telnet -a -l admin FVM_A:IPV4_PORT2 
    expect -e "login" -t 50 -for 811539
    ctrl_c
 #   sleep 10

    ########SSH#################
    ssh-keygen -f "/root/.ssh/known_hosts" -R FVM_A:IPV4_PORT2 
    sshpass -p admin ssh -o StrictHostKeyChecking=no admin@FVM_A:IPV4_PORT2
    get system status
    expect -e "Version" -for 811539 -t 5
    exit

    #ssh admin@FVM_A:IPV4_PORT2
    #sleep 3
    #yes
    #get sys status
    #expect -e "FGVM" -for updateSSH -t 5
    #exit
    #sleep 10

    #echo "get system status" | sshpass -p admin ssh -o StrictHostKeyChecking=no admin@FVM_A:IPV4_PORT2
    #expect -e "Version" -t 50 -for 811539
    #ctrl_c
    #exit
	
    ########SNMP#################
    snmpgetnext -v 1 -c REGR-SYS FVM_A:IPV4_PORT2 1.3.6.1.2.1.47.1.1.1.1.11
    expect -e "FGVM" -t 10 -for 811539
	
    ########HTTP#################	
    curl -v -sD - -o /dev/null  http://FVM_A:IPV4_PORT2
    expect -e "Connected to FVM_A:IPV4_PORT2" -for 811539 -t 10
    expect -e "200 OK"  -for 811539 -t 10

[FVM_A]
    ########Test HTTPS#################
    config system global
       unset admin-https-redirect
    end

[PC_01]
    #curl -g -v -k https://FVM_A:IPV4_PORT2
    curl -v -sD - -o /dev/null  https://FVM_A:IPV4_PORT2
    expect -e "Connected to FVM_A:IPV4_PORT2" -for 811539 -t 10

	
[FVM_A]
    
   report 811539

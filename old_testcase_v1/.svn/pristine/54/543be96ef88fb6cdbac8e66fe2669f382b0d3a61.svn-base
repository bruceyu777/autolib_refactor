# 849490ï¼šVerify FGTVM turn into Lenc mode with non-vdom lenc license
# fortiguard anycast is removed since 7.0.2
# anycast is disabled - 6.4 -- 7.0.1 
# 
#####################################################################

[FVM_A]
    ### 849490.txt ###
    comments: Verify lenc non-vdom license can be valided 

    # get license file name
    setlicense -t LENCNVD -for SN -to lic
 
    #remove license
    execute factoryreset2    
    
    get system status | grep 'Serial-Number' -A 5
    expect -e "License Status: Invalid" -for 849490 -t 5

    # low-enc not support anycast
    config system fortiguard
        set fortiguard-anycast disable
    end

    execute restore vmlicense tftp FVM_A:LICENSE_DIR{$lic} FVM_A:LICENSE_SERVER
	
    show full system fortiguard | grep protocol
    expect -e "https" -for 849490 -t 5

    get system status | grep 'domains'
    expect -e "Max number of virtual domains: 1" -for 849490 -t 10

    get system status | grep 'License'
    expect -e "License Status: Valid" -for 927040 -t 5
    expect -e "Low-Encryption\\(LENC\\)" -for 849490 -t 10
   
    report 849490
    report 927040


############## 811539 ##################
#####Note: Need to change the field PC_05:FORTIVMSN in env.conf if changed vm license.#####
[FVM_A]
	comment 811539:Busy:Verify Interface administrative access http, https, telnet, ssh, ping, snmp works when set allowaccess

	
config system interface
    edit "FVM_A:PORT2"
        set vdom "root"
        set ip FVM_A:IPV4_PORT2 255.255.255.0
        set allowaccess ping https ssh snmp http telnet 
    next
end

    config sys global
        set admin-https-redirect disable
	set admin-https-ssl-versions tlsv1-0 tlsv1-1 tlsv1-2
    end

config system snmp sysinfo
set status enable
set description "fortivm64"
set contact-info "lab"
set location "lab"
end

config system snmp community
edit 1
set name "REGR-SYS"
config hosts
edit 1
set ip 10.1.100.11 255.255.255.255
next
end
set events cpu-high mem-low log-full intf-ip vpn-tun-up vpn-tun-down ha-switch ha-hb-failure ips-signature ips-anomaly av-virus av-oversize av-pattern av-fragmented fm-if-change bgp-established bgp-backward-transition ha-member-up ha-member-down ent-conf-change av-conserve av-bypass av-oversize-passed av-oversize-blocked ips-pkg-update ips-fail-open faz-disconnect wc-ap-up wc-ap-down
next
end

	
[PC_01] 
 
    #########PING###############
    ping -c 5 FVM_A:IPV4_PORT2
    expect -e "64 bytes from" -t 10 -for 811539
    sleep 10

    ########TELNET##############
    telnet -a -l admin FVM_A:IPV4_PORT2 
    expect -e "login" -t 50 -for 811539
    ctrl_c
 #   sleep 10

    ########SSH#################
    echo "get system status" | ssh -o StrictHostKeyChecking=no admin@FVM_A:IPV4_PORT2
    expect -e "Version" -t 50 -for 811539
    ctrl_c

	
    ########SNMP#################
    snmpgetnext -v 1 -c REGR-SYS PC_05:FORTIVM01_PORT2_IPV4  1.3.6.1.2.1.47.1.1.1.1.11
    expect -e "FGVM" -t 10 -for 811539
	
    ########HTTP#################	
    rm -f TEMP
    curl -k -m 100 -s http://FVM_A:IPV4_PORT2/logincheck -d "username=admin&secretkey=admin" -o TEMP    
    sleep 2
    cat TEMP
    expect -e "login" -fail match -t 15 -for 811539
	rm -f TEMP

    ########HTTPS#################	
    rm -f TEMPS
    curl -k -m 100 -s https://FVM_A:IPV4_PORT2/logincheck -d "username=admin&secretkey=admin" -o TEMPS
    sleep 2
    cat TEMPS
    expect -e "login" -fail match -t 15 -for 811539	
    rm -f TEMPS
	
    report 811539

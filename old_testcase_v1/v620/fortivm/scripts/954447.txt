# Test Case: 954447:Post-Paid flex vm after factoryreset keepvmlicense
# Test Case: 954446:Post-Paid flex vm after factoryreset
# Used time: 
############################################################ 

[FVM_B]

    comment Verify 954447:Post-Paid flex vm factoryreset keepvmlicense
    comment Verify 954446:Post-Paid flex vm after factoryreset

    get system status | grep 'Serial-Number' -A 5
    expect -e "License Status: Valid" -for 954447 -t 10

    diag deb vm-print-license
    expect -e "Model: ML" -for 954447 -t 5

    execute factoryreset keepvmlicense 
    y
    sleep 120

    config system interface
        edit FVM_B:PORT1
            set mode static
            set ip  FVM_B:IPV4_PORT1 255.255.255.0
            set allowaccess ping https ssh http telnet
        next
    end

    config router static
        edit 1
            set gateway 10.6.30.254
            set device FVM_B:PORT1
        next
    end
    
    sleep 30
 
    get system status | grep 'Serial-Number' -A 5
    expect -e "License Status: Valid" -for 954447 -t 10
 
    diag deb vm-print-license
    expect -e "Model: ML" -for 954447 -t 5
    
    report 954447

[FVM_B]
    exec factoryreset
    y
    sleep 120

    get system status | grep 'Serial-Number' -A 5
    expect -e "FGVMEV" -for 954446 -t 10
    expect -e "License Status: Invalid" -for 954446 -t 10

#    report 954447
    report 954446

[FVM_B]
    comment: apply a offline license
    setlicense -t OFFLINE -for SN -to lic

    config sys console
       set output standard
    end

    config system interface
        edit FVM_B:PORT1
            set mode static
            set ip  FVM_B:IPV4_PORT1 255.255.255.0
            set allowaccess ping https ssh http telnet
        next
    end

    config router static
        edit 1
            set gateway 10.6.30.254
            set device FVM_B:PORT1
        next
    end

    execute restore vmlicense tftp FVM_B:LICENSE_DIR{$lic} FVM_B:LICENSE_SERVER
    sleep 60

